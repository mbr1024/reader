# å°è¯´é˜…è¯»å™¨ - å¼€å‘è®¡åˆ’æ–‡æ¡£

> æœ€åæ›´æ–°æ—¶é—´: 2026-01-29
> å½“å‰è¿›åº¦: æ ¸å¿ƒä½“éªŒå¼€å‘ä¸­

---

## é¡¹ç›®æ¦‚è¿°

è·¨å¹³å°å°è¯´é˜…è¯»å™¨ Appï¼Œæ”¯æŒ Android å’Œ iOSï¼Œæä¾›åœ¨çº¿é˜…è¯»ã€ç¦»çº¿ç¼“å­˜ã€ç”¨æˆ·ç³»ç»Ÿå’Œå¹¿å‘Šå˜ç°åŠŸèƒ½ã€‚

### æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯é€‰å‹ |
|------|---------|
| ç§»åŠ¨ç«¯ | Flutter 3.x + Riverpod + GoRouter + Hive |
| åç«¯ | NestJS + Prisma + PostgreSQL + Redis |
| éƒ¨ç½² | Docker |

---

## å¼€å‘ä¼˜å…ˆçº§

æŒ‰é‡è¦ç¨‹åº¦æ’åºï¼Œä¼˜å…ˆä¿è¯æ ¸å¿ƒé˜…è¯»ä½“éªŒã€‚

### ğŸ”´ P0 - æ ¸å¿ƒä½“éªŒï¼ˆå½“å‰å¼€å‘ä¸­ï¼‰

| åŠŸèƒ½ | è¯´æ˜ | çŠ¶æ€ |
|------|------|------|
| é˜…è¯»è¿›åº¦æŒä¹…åŒ– | é€€å‡ºåè®°ä½é˜…è¯»ä½ç½® | â³ |
| ä¹¦æ¶æ•°æ®æŒä¹…åŒ– | åŠ å…¥ä¹¦æ¶å®é™…å­˜å‚¨åˆ°æœ¬åœ° | â³ |
| ç« èŠ‚ç¼“å­˜/ç¦»çº¿é˜…è¯» | æ— ç½‘ç»œæ—¶å¯é˜…è¯»å·²ç¼“å­˜ç« èŠ‚ | â³ |
| Token æŒä¹…åŒ– | ç™»å½•åè‡ªåŠ¨ä¿æŒç™»å½•çŠ¶æ€ | â³ |
| é˜…è¯»è®¾ç½®æŒä¹…åŒ– | è®°ä½å­—ä½“å¤§å°ã€èƒŒæ™¯è‰²ç­‰åå¥½ | â³ |

### ğŸŸ  P1 - å¹¿å‘Šå˜ç°

| åŠŸèƒ½ | è¯´æ˜ | çŠ¶æ€ |
|------|------|------|
| å¹¿å‘Š SDK é›†æˆ | AdMob / ç©¿å±±ç”² | â³ |
| å¼€å±å¹¿å‘Š | åº”ç”¨å¯åŠ¨æ—¶å±•ç¤º | â³ |
| ç« èŠ‚åˆ‡æ¢æ’å±å¹¿å‘Š | é˜…è¯» N ç« åå±•ç¤º | â³ |
| ä¹¦æ¶é¡µ Banner å¹¿å‘Š | é¡µé¢åº•éƒ¨æŒç»­æ›å…‰ | â³ |

### ğŸŸ¡ P2 - é˜…è¯»ä½“éªŒä¼˜åŒ–

| åŠŸèƒ½ | è¯´æ˜ | çŠ¶æ€ |
|------|------|------|
| ç¿»é¡µæ•ˆæœ | ä»¿çœŸ/æ»‘åŠ¨/ç‚¹å‡»ç¿»é¡µ | â³ |
| ä¹¦ç­¾åŠŸèƒ½ | æ ‡è®°é‡è¦ä½ç½® | â³ |
| æ‰¹é‡ä¸‹è½½ | ä¸‹è½½å N ç« /å…¨éƒ¨ | â³ |
| æœç´¢æœ¬ä¹¦å†…å®¹ | æŸ¥æ‰¾å…³é”®è¯ | â³ |
| äº®åº¦è°ƒèŠ‚ | é˜…è¯»æ—¶è°ƒèŠ‚å±å¹•äº®åº¦ | â³ |
| å±å¹•å¸¸äº® | é˜…è¯»æ—¶ä¿æŒå±å¹•å¸¸äº® | â³ |

### ğŸŸ¢ P3 - äº‘åŒæ­¥

| åŠŸèƒ½ | è¯´æ˜ | çŠ¶æ€ |
|------|------|------|
| é˜…è¯»è¿›åº¦äº‘åŒæ­¥ | å¤šè®¾å¤‡åŒæ­¥é˜…è¯»ä½ç½® | â³ |
| ä¹¦æ¶æ•°æ®äº‘åŒæ­¥ | å¤šè®¾å¤‡åŒæ­¥ä¹¦æ¶ | â³ |
| ä¹¦ç­¾äº‘åŒæ­¥ | å¤šè®¾å¤‡åŒæ­¥ä¹¦ç­¾ | â³ |

### âšª P4 - å‘å¸ƒå‡†å¤‡

| åŠŸèƒ½ | è¯´æ˜ | çŠ¶æ€ |
|------|------|------|
| App å›¾æ ‡ä¸å¯åŠ¨é¡µ | å“ç‰Œå½¢è±¡ | â³ |
| Android ç­¾åé…ç½® | å‘å¸ƒå¿…é¡» | â³ |
| iOS è¯ä¹¦é…ç½® | å‘å¸ƒå¿…é¡» | â³ |
| åº”ç”¨å•†åº—ç´ æ | æˆªå›¾ã€æè¿°ã€å…³é”®è¯ | â³ |

---

## å·²å®ŒæˆåŠŸèƒ½

### âœ… é˜¶æ®µä¸€ï¼šé¡¹ç›®åˆå§‹åŒ–

#### 1.1 Flutter App åˆå§‹åŒ–
- [x] åˆ›å»º Flutter é¡¹ç›®
- [x] é…ç½®é¡¹ç›®ç»“æ„ (feature-first)
- [x] é›†æˆæ ¸å¿ƒä¾èµ–åŒ…
  - flutter_riverpod, riverpod_annotation
  - go_router
  - dio
  - hive, hive_flutter
  - flutter_screenutil
  - cached_network_image
  - connectivity_plus
- [x] é…ç½® App ä¸»é¢˜
- [x] é…ç½®è·¯ç”±ç³»ç»Ÿ

#### 1.2 åç«¯åˆå§‹åŒ–
- [x] åˆ›å»º NestJS é¡¹ç›®
- [x] é…ç½® Prisma + PostgreSQL
- [x] åˆ›å»ºæ•°æ®åº“ Schema (6 å¼ æ ¸å¿ƒè¡¨)
- [x] é…ç½®ç¯å¢ƒå˜é‡
- [x] åç«¯ç¼–è¯‘é€šè¿‡

#### 1.3 å·²åˆ›å»ºçš„é¡µé¢
- [x] ç™»å½•é¡µ
- [x] ä¹¦æ¶é¡µ
- [x] å‘ç°é¡µ
- [x] è®¾ç½®é¡µ
- [x] é˜…è¯»å™¨é¡µ
- [x] ä¹¦ç±è¯¦æƒ…é¡µ

#### 1.4 åç«¯å·²å®Œæˆæ¨¡å—
- [x] Prisma æ¨¡å—
- [x] è®¤è¯æ¨¡å— (æ³¨å†Œ/ç™»å½•/Tokenåˆ·æ–°/é€€å‡º)
- [x] ä¹¦æºæ¨¡å— (æœç´¢/è¯¦æƒ…/ç« èŠ‚åˆ—è¡¨/ç« èŠ‚å†…å®¹)

#### 1.5 é˜…è¯»å™¨åŸºç¡€åŠŸèƒ½
- [x] å­—ä½“å¤§å°è°ƒèŠ‚
- [x] è¡Œé—´è·è°ƒèŠ‚
- [x] èƒŒæ™¯è‰²ä¸»é¢˜ (ç™½/é»„/ç»¿/é»‘)
- [x] ç›®å½•è·³è½¬
- [x] è¿›åº¦æ¡å¿«é€Ÿè·³è½¬

---

## é¡¹ç›®ç»“æ„

```
reader/
â”œâ”€â”€ app/                          # Flutter ç§»åŠ¨ç«¯
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ main.dart             # å…¥å£æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ app/                  # App é…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ config/           # åº”ç”¨é…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ router/           # è·¯ç”±é…ç½®
â”‚   â”‚   â”‚   â””â”€â”€ theme/            # ä¸»é¢˜é…ç½®
â”‚   â”‚   â”œâ”€â”€ features/             # åŠŸèƒ½æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/             # ç™»å½•æ³¨å†Œ
â”‚   â”‚   â”‚   â”œâ”€â”€ bookshelf/        # ä¹¦æ¶
â”‚   â”‚   â”‚   â”œâ”€â”€ book_detail/      # ä¹¦ç±è¯¦æƒ…
â”‚   â”‚   â”‚   â”œâ”€â”€ explore/          # å‘ç°/æœç´¢
â”‚   â”‚   â”‚   â”œâ”€â”€ reader/           # é˜…è¯»å™¨æ ¸å¿ƒ
â”‚   â”‚   â”‚   â””â”€â”€ settings/         # è®¾ç½®
â”‚   â”‚   â”œâ”€â”€ core/                 # æ ¸å¿ƒå·¥å…·ç±»
â”‚   â”‚   â””â”€â”€ shared/               # å…±äº«ç»„ä»¶
â”‚   â””â”€â”€ pubspec.yaml
â”‚
â”œâ”€â”€ server/                       # Node.js åç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ main.ts
â”‚   â”‚   â”œâ”€â”€ app.module.ts
â”‚   â”‚   â”œâ”€â”€ modules/
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/             # è®¤è¯æ¨¡å— âœ…
â”‚   â”‚   â”‚   â”œâ”€â”€ book-source/      # ä¹¦æºæ¨¡å— âœ…
â”‚   â”‚   â”‚   â”œâ”€â”€ prisma/           # æ•°æ®åº“æ¨¡å— âœ…
â”‚   â”‚   â”‚   â””â”€â”€ sync/             # åŒæ­¥æ¨¡å—
â”‚   â”‚   â””â”€â”€ common/               # å…¬å…±æ¨¡å—
â”‚   â”œâ”€â”€ prisma/
â”‚   â”‚   â””â”€â”€ schema.prisma         # æ•°æ®åº“æ¨¡å‹ âœ…
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ DEVELOPMENT.md                # æœ¬æ–‡æ¡£
â””â”€â”€ docker-compose.yml            # Docker é…ç½®
```

---

## æ•°æ®åº“è®¾è®¡

```sql
-- ç”¨æˆ·è¡¨
users (
  id, email, phone, password_hash,
  nickname, avatar, created_at, updated_at
)

-- åˆ·æ–°ä»¤ç‰Œè¡¨
refresh_tokens (
  id, user_id, token, expires_at, created_at
)

-- ä¹¦ç±è¡¨
books (
  id, source_id, source_type,
  title, author, cover, description,
  category, status, created_at, updated_at
)

-- ç« èŠ‚è¡¨
chapters (
  id, book_id, chapter_index,
  title, content, word_count, created_at
)

-- ä¹¦æ¶è¡¨
bookshelves (
  id, user_id, book_id,
  last_chapter, last_position,
  is_top, last_read_at, created_at, updated_at
)

-- ä¹¦ç­¾è¡¨
bookmarks (
  id, user_id, book_id, chapter_id,
  position, note, created_at
)
```

---

## ç¯å¢ƒé…ç½®

### åç«¯ç¯å¢ƒå˜é‡ (`server/.env`)

```bash
# Database
DATABASE_URL="postgresql://reader:reader123@localhost:5432/reader_db?schema=public"

# JWT
JWT_SECRET="your-super-secret-jwt-key-change-in-production"
JWT_EXPIRES_IN="15m"
JWT_REFRESH_EXPIRES_IN="7d"

# Server
PORT=3000
NODE_ENV=development
```

### å¯åŠ¨å‘½ä»¤

```bash
# å¯åŠ¨æ•°æ®åº“
docker-compose up -d

# åç«¯
cd server
npm install
npx prisma generate
npx prisma migrate dev
npm run start:dev

# Flutter App
cd app
flutter pub get
flutter run
```

---

## æœ¬åœ°å­˜å‚¨è®¾è®¡ (Hive)

ç”¨äº P0 æ ¸å¿ƒä½“éªŒåŠŸèƒ½çš„æœ¬åœ°æŒä¹…åŒ–ã€‚

### Box è®¾è®¡

| Box åç§° | ç”¨é€” | æ•°æ®ç»“æ„ |
|---------|------|---------|
| `auth` | Token å­˜å‚¨ | accessToken, refreshToken, userId |
| `bookshelf` | ä¹¦æ¶æ•°æ® | List<BookshelfItem> |
| `reading_progress` | é˜…è¯»è¿›åº¦ | Map<bookId, {chapterId, position}> |
| `settings` | é˜…è¯»è®¾ç½® | fontSize, lineHeight, bgColor, etc. |
| `chapter_cache` | ç« èŠ‚ç¼“å­˜ | Map<chapterId, content> |

---

## ä¸‹ä¸€æ­¥å·¥ä½œ

1. **åˆ›å»º Hive æ•°æ®æ¨¡å‹** - å®šä¹‰æœ¬åœ°å­˜å‚¨çš„æ•°æ®ç»“æ„
2. **å®ç°é˜…è¯»è¿›åº¦æŒä¹…åŒ–** - é€€å‡ºé˜…è¯»å™¨æ—¶ä¿å­˜è¿›åº¦
3. **å®ç°ä¹¦æ¶æœ¬åœ°å­˜å‚¨** - åŠ å…¥ä¹¦æ¶åŠŸèƒ½
4. **å®ç° Token æŒä¹…åŒ–** - è‡ªåŠ¨ç™»å½•
5. **å®ç°é˜…è¯»è®¾ç½®æŒä¹…åŒ–** - è®°ä½ç”¨æˆ·åå¥½
